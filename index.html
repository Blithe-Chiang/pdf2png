<!DOCTYPE html>
<html>
<head lang="zh-CN">
    <title>PDF转长图</title>
    <meta charset="utf-8">
    <!-- 下面三个是使用 uploadfile 需要用到的 -->
    <link href="http://hayageek.github.io/jQuery-Upload-File/4.0.11/uploadfile.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="http://hayageek.github.io/jQuery-Upload-File/4.0.11/jquery.uploadfile.min.js"></script>
    <script type="text/javascript">

        function show(status, filename) {
            if (status == 200) {
                download = $('<a></a>').text(filename)
                            .attr({
                                    'href': 'download.php?filename='+filename,
                                    'download': filename
                                });
                $('<span></span>').html(download).prependTo("#output");
            } else {
                $("<span></span>").text('转换出现了错误').prependTo("#output");
            }
        }

        function convertAndGetResult(id, originalFilename){
            console.log('转换中...');
            $.getJSON('convert.php?id=' + id, function(data){
                console.log('转换结束...');
		filename = originalFilename.slice(0,-3) + 'png';
                show(data['status'], filename);
            });
        }
    </script>
</head>
<body>

    <!-- 使用 uploadfile 必须加入的 -->
    <div id="fileuploader">Upload</div>


    <div id="output"></div>

    <script>
        $(document).ready(function()
        {
            $("#fileuploader").uploadFile({
                maxFileSize:50*1024*1024,           // 上传的文件的大小限制  单位 B
                allowedTypes: "pdf",
                url:"./upload.php",                 // 上传的URL
                fileName:"myfile",

                // callback to be invoked when the upload is successful.
                onSuccess:function(files,data,xhr,pd)
                {
                    //files: list of files
                    //data: response from server
                    //xhr : jquer xhr object
                    //
                    // console.log(files);
	            id = data['id'];
                    convertAndGetResult(id, files[0]);
                }

            });
        });
    </script>


</body>
</html>
